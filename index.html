<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PeritIA - Entrenador Judicial</title>
  <!-- Tailwind CSS -->
  <link rel="stylesheet" href="css/style.css" />
  <!-- Google Fonts: Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
    rel="stylesheet"
  />
  <!-- Heroicons -->
  <script src="https://unpkg.com/heroicons@2.1.3/24/outline/index.js"></script>
</head>
<body class="light font-inter flex h-screen bg-[#1C1C1C] text-gray-200">
    <!-- Sidebar (unchanged) -->
    <aside id="sidebar" class="w-72 p-3 flex flex-col fixed inset-y-0 left-0 transform -translate-x-full md:relative md:translate-x-0 transition-transform duration-300 ease-in-out z-30 backdrop-blur-sm border-r border-white/10">

    <div class="flex items-center justify-center mb-6">
        <div class="flex items-center gap-2">
            <div class="p-1.5">
               <img class="w-100" src="assets/img/logo.svg" alt="">
            </div>
        </div>
    </div>


<div class="flex-grow mt-6 overflow-y-auto custom-scrollbar -mr-3 pr-3">
                 <h3 class="px-3 text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Dictamenes Recientes</h3>
                <nav id="dictamenesRecientes" class="flex flex-col gap-1"></nav>
            </div>

    </aside>

  <!-- Overlay para mobile sidebar -->
  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-60 z-20 hidden md:hidden"></div>

  <!-- Main -->
  <main class="flex-1 flex flex-col">

    <!-- Mobile Header -->
    <header
      class="md:hidden flex items-center justify-between p-2 bg-black/80 backdrop-blur-sm border-b border-white/10 sticky top-0 z-10"
    >
      <button id="menu-btn" class="p-2 rounded-lg hover:bg-white/10">
        <!-- icono hamburguesa -->
      </button>
      <h1 class="text-lg font-semibold">PeritIA</h1>
      <button id="new-chat-btn" class="p-2 rounded-lg hover:bg-white/10">
        <!-- icono nueva simulación -->
      </button>
    </header>

    <!-- Controles de PeritIA arriba del chat -->
    <div class="p-3">
  <div class="max-w-4xl mx-auto flex flex-col md:flex-row md:items-center justify-between">

<div class="file-input">
    <input
        type="file"
        id="dictamenInput"
        accept=".txt,application/pdf"
        class="file-input__input"
    />
      <label class="file-input__label " for="dictamenInput">
        <svg
          aria-hidden="true"
          focusable="false"
          data-prefix="fas"
          data-icon="upload"
          class="svg-inline--fa fa-upload fa-w-16"
          role="img"
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 512 512"
        >
          <path
            fill="currentColor"
            d="M296 384h-80c-13.3 0-24-10.7-24-24V192h-87.7c-17.8 0-26.7-21.5-14.1-34.1L242.3 5.7c7.5-7.5 19.8-7.5 27.3 0l152.2 152.2c12.6 12.6 3.7 34.1-14.1 34.1H320v168c0 13.3-10.7 24-24 24zm216-8v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h136v8c0 30.9 25.1 56 56 56h80c30.9 0 56-25.1 56-56v-8h136c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z"
          ></path>
        </svg>
        <span>Cargar dictamen</span></label
      >
      <span id="dictamenIcon" class="ml-2 text-xl"></span>
    </div>


        <label class="inline-flex items-center cursor-pointer">
        <input id="modoToggle" type="checkbox" class="sr-only peer" />
        <div
            class="relative w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300
                dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700
                peer-checked:bg-blue-600 peer-checked:after:translate-x-full
                after:content-[''] after:absolute after:top-[2px] after:left-[2px]
                after:bg-white after:border-gray-300 after:border after:rounded-full
                after:h-5 after:w-5 after:transition-all"
        ></div>
        <span class="ml-3 font-medium text-gray-200 smt">Litigio</span>
        </label>



        <select
          id="modoSimulacion"
          class="dark:bg-slate-800 dark:text-slate-200 dark:placeholder-slate-400 dark:focus:ring-blue-500 sm:text-base"
        >
          <option value="actor">Parte Actora</option>
          <option value="demandado">Parte Demandada</option>
          <option value="mixto">Audiencia Mixta</option>
        </select>
        <button
          id="iniciarBtn"
          class="bottom-2 right-2.5 rounded-lg bg-blue-700 px-4 py-2 smt font-medium text-slate-200 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"
        >
          Iniciar Simulación
        </button>
      </div>
    </div>



    <!-- Chat Container -->
    <div class="flex-1 overflow-y-auto p-4 md:p-6 custom-scrollbar scroll-smooth">
      <div id="chatContainer" class="max-w-4xl mx-auto"></div>
          <!-- Indicador de carga -->
    <div id="cargando" class="hidden text-center py-4 flex flex-col justify-center items-center h-full">
      <div class="spinner mx-auto mb-2"></div>
      <p>Procesando dictamen y generando preguntas...</p>
    </div>
    </div>

    <!-- Área de respuesta y exportación -->
    <div class="p-4 md:p-6">
      <div class="max-w-4xl mx-auto flex flex-col space-y-3">
        
        <div class="relative">
            <textarea id="respuestaPerito" rows="1" placeholder="Escribe tu respuesta como perito..." class="block w-full resize-none rounded-xl border-none bg-slate-200 p-4 pr-20 text-sm text-slate-900 focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:text-slate-200 dark:placeholder-slate-400 dark:focus:ring-blue-500 sm:text-base"
            ></textarea>
            <button id="evaluarBtn" class="absolute bottom-2 right-2.5 rounded-lg bg-blue-700 px-4 py-2 text-sm font-medium text-slate-200 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 smt">
                Enviar
            </button>
        </div>

        <div class="flex space-x-2">

          <button
            id="exportarPdfBtn"
            class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-md hidden"
          >
            Exportar historial a PDF
          </button>
          <button
            id="exportarPreguntasBtn"
            class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md hidden"
          >
            Exportar solo Preguntas
          </button>
        </div>
      </div>
    </div>

  </main>

  <!-- Librerías Globales -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script type="module">
    import * as pdfjsLib from './assets/js/pdf.min.js';
    window.pdfjsLib = pdfjsLib;
    pdfjsLib.GlobalWorkerOptions.workerSrc = './assets/js/pdf.worker.min.js';
  </script>
  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>


  <!-- Lógica de la app -->
  <script>window.API_BASE_URL = "http://127.0.0.1:4000";</script>
  <script type="module" src="js/main.js"></script>
</body>
</html>
